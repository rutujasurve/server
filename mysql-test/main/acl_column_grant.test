CREATE USER foo;
CREATE DATABASE db_for_test;
CREATE TABLE db_for_test.t1 (a int);
INSERT INTO db_for_test.t1 values (1), (2), (3);
CREATE TABLE db_for_test.t2 (a int, b int);
INSERT INTO db_for_test.t2 values (1,2), (2,3), (3,4);
CREATE TABLE db_for_test.t3 (a int);
INSERT INTO db_for_test.t3 values (1), (2), (3);
--change_user foo
# Without grants
SHOW DATABASES;
--error ER_DBACCESS_DENIED_ERROR
USE db_for_test;
--error ER_DBACCESS_DENIED_ERROR
USE foodb;
--error ER_DBACCESS_DENIED_ERROR
SHOW TABLES FROM db_for_test;
#SELECT  * FROM INFORMATION_SCHEMA.tables;
#SELECT * FROM INFORMATION_SCHEMA.columns;
--error ER_TABLEACCESS_DENIED_ERROR
SELECT * FROM db_for_test.t1;
--error ER_TABLEACCESS_DENIED_ERROR
SELECT a FROM db_for_test.t1;
--error ER_TABLEACCESS_DENIED_ERROR
SELECT b FROM db_for_test.t1;
--error ER_TABLEACCESS_DENIED_ERROR
SELECT a,b FROM db_for_test.t1;

--change_user root
USE db_for_test;
GRANT SELECT(a) ON db_for_test.t1 TO foo;
GRANT SELECT(a) ON db_for_test.t2 TO foo;
--change_user foo
SHOW DATABASES;
USE db_for_test;
SHOW TABLES FROM db_for_test;
--error ER_TABLEACCESS_DENIED_ERROR
#SELECT * FROM INFORMATION_SCHEMA;
SELECT * FROM db_for_test.t1;
--error ER_TABLEACCESS_DENIED_ERROR
SELECT a FROM db_for_test.t1;
--error ER_TABLEACCESS_DENIED_ERROR
SELECT b FROM db_for_test.t1;
--error ER_TABLEACCESS_DENIED_ERROR
SELECT b FROM db_for_test.t2;
SELECT * FROM INFORMATION_SCHEMA.columns WHERE TABLE_NAME='t2';


--change_user root
GRANT SELECT ON db_for_test.t1 TO foo;
GRANT SELECT ON db_for_test.t2 TO foo;
DENY SELECT(a) ON db_for_test.t1 TO foo;
DENY SELECT(a) ON db_for_test.t2 TO foo;
--change_user foo
--error ER_TABLEACCESS_DENIED_ERROR
SELECT b FROM db_for_test.t1;
--error ER_TABLEACCESS_DENIED_ERROR
SELECT a FROM db_for_test.t1;
--error ER_TABLEACCESS_DENIED_ERROR
SELECT b FROM db_for_test.t2;

