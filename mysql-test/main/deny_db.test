CREATE DATABASE db_for_test;
CREATE USER foo;
CREATE USER bar;
CREATE TABLE db_for_test.t1 (a int);
INSERT INTO db_for_test.t1 values (1), (2), (3);
GRANT ALL ON db_for_test.* TO foo;
GRANT ALL ON db_for_test.* TO bar;
--change_user foo
# This command should return both rows of t1.
select * from db_for_test.t1;
--change_user root
select user, host, db, select_priv, denied_priv from mysql.db;
DENY SELECT ON db_for_test.* TO foo;
select user, host, db, select_priv, denied_priv from mysql.db;
--change_user foo
# The command should now fail with permission denied.
--error ER_DBACCESS_DENIED_ERROR
SHOW TABLES FROM db_for_test;
--error ER_DBACCESS_DENIED_ERROR
select * from db_for_test.t1;
--error ER_DBACCESS_DENIED_ERROR
select * from db_for_test.t3;
--change_user root
DENY INSERT ON db_for_test.* TO foo;
select user, host, db, select_priv, denied_priv from mysql.db;
--change_user foo
--error ER_DBACCESS_DENIED_ERROR
INSERT INTO db_for_test.t1 values (5), (6), (7);
--error ER_DBACCESS_DENIED_ERROR
SELECT * from db_for_test.t1;
--change_user root
flush privileges;
--change_user foo
--error ER_DBACCESS_DENIED_ERROR
SELECT * from db_for_test.t1;
--error ER_DBACCESS_DENIED_ERROR
INSERT INTO db_for_test.t1 values (5), (6), (7);
--change_user bar
select * from db_for_test.t1;
--change_user root
CREATE DATABASE db_foo;
CREATE TABLE db_foo.t1 (a int);
INSERT INTO db_foo.t1 values (1), (2);
GRANT ALL ON db_foo.* to foo;
--change_user foo
select * from db_foo.t1;
--change_user root
drop user foo;
drop user bar;
drop database db_foo;
drop database db_for_test;
